# https://taskfile.dev
# run task from the root with "task {mytask} -t /build/Taskfile.yaml"

version: '3'

interval: '1000ms'

tasks:

#> task -t ./build/Taskfile.yaml build2docs
  build2docs:
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - rm -rf ./docs
      - mkdir -p ./docs
      - cp -R ./web/static/** ./docs
      - cp ./web/static/.nojekyll ./docs
      - cp ./docs/linkerpod_bkp.yaml ./docs/linkerpod.yaml
      - mv ./docs/linkerpod.html ./docs/index.html
      - GOARCH=wasm GOOS=js go build -o ./docs/webapp.wasm ./web/wasm

#> task -t ./build/Taskfile.yaml build2website
  build2website:
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - mkdir -p ./website
      - cp -R ./web/static/** ./website
      - GOARCH=wasm GOOS=js go build -o ./website/webapp.wasm ./web/wasm

  static:
    dir: '{{.USER_WORKING_DIR}}'
    sources: 
      - "./web/static/**/*"
    cmds: 
      - cp -R ./web/static/** ./website

  wasm:
    dir: '{{.USER_WORKING_DIR}}'
    sources: 
      - "web/wasm/*"
    cmds: 
      - GOARCH=wasm GOOS=js go build -o ./website/webapp.wasm ./web/wasm

#> task -t ./build/Taskfile.yaml website --watch
  website:
    dir: '{{.USER_WORKING_DIR}}'
    cmds: 
      - mkdir -p ./website
      - task: static
      - task: wasm
